# TrueNil: A Genomic Data Discovery and Protection Tool
Author: Trupti Shiralkar
Presentation link: [TrueNil_Overview_1.0.pptx](https://docs.google.com/presentation/d/10f8fMXXR59iRH8OINEujnH3iiPI_ZRvW/edit?usp=sharing&ouid=110646254812585683372&rtpof=true&sd=true)

## Overview
TrueNil is an open-source, multi-tenant SaaS for genomic data discovery and protection. It raises awareness about genomic data security & privacy challenges among developers and security professionals. It detects sensitive data types, encryption at rest status, and access control.

## Security & Privacy Concerns related to Genomic Data
In contrast to other types of sensitive data like credit card or social security numbers, insecure handling of genomic data poses unique implications:
- Privacy Concerns: Small pieces of genomic data combined with other information can lead to inference attacks.
- National Security Concerns: Genomic data could be exploited for population surveillance, oppression, or extortion against citizens, military, and intelligence personnel. Inadequate integrity controls on genomic data could allow manipulation to produce toxic products or infectious agents, resulting in loss of life and economic damage. Large genomic databases could potentially be used in bioweapon development due to their extensive genetic information, which could be exploited to identify vulnerabilities or targets.
- Unintended Consequences from Sample Bias: AI and statistics use large genomic datasets to identify diseases, assess risks, determine treatments, and predict patient outcomes. However, minority groups are often underrepresented in this data. This exacerbates biases, particularly in AI, potentially leading to unfair results in analyses and predictions. (Reference: NIST IR 8432 “Cybersecurity of Genomic Data”)

## Motivation
Genomic data plays a crucial role in modern healthcare, holding immense potential for personalized medicine and targeted therapies. But harnessing this power requires robust IT infrastructure, secure data handling, and developer-friendly tools. There are several types of genomics companies that specialize in various areas of genomics research and application. Here are some of the most common types:
- Genomic sequencing companies specialize in providing DNA sequencing services to researchers, healthcare providers, and individuals. These are specialized data pipelines for processing the massive amounts of raw sequence data generated by machines. Developers ensure efficient data flow, integration with analysis tools, and scalability for future growth. Security is paramount here, protecting sensitive patient information.
- Genomic data analytics companies: These companies develop software and analytics tools to help researchers and clinicians interpret genomic data. These platforms provide the computational muscle for analyzing genomic data. Developers build and maintain these platforms, focusing on data visualization, secure access controls, and integration with external tools and databases.
- Genomic medicine companies use genomic data to develop personalized therapies and diagnostics for patients. They rely on a collaborative effort between IT, development, and security professionals to securely manage, analyze, and leverage the power of genetic data for personalized medicine.
- Direct-to-consumer genomics companies provide genetic testing services directly to consumers, allowing individuals to learn about their genetic risks for certain diseases and ancestry. They prioritize responsible use of genetic information through secure data handling, user-friendly interfaces, and clear communication about data usage to build trust with their customers.
- Synthetic biology companies: These companies engineer biological systems using genetic engineering techniques to create new drugs, materials, and organisms. Synthetic biology raises concerns about potential misuse. Security teams implement measures to prevent unauthorized access to sensitive genetic data that could be used for harmful purposes.
- Genomic Data Storage and Analysis Platforms: With the growing volume of genomic data, there are companies that specialize in providing secure storage, management, and analysis platforms specifically designed for genomic data. These platforms enable researchers and clinicians to store, access, and analyze large-scale genomics datasets efficiently.
- Gene and cell therapy companies analyze genetic data to understand the root cause (such as missing or mutated gene) of diseases they are targeting. This information is used to create modified genes to deliver to a patient's cells or identify the best way to edit a patient's genes. Protecting such platforms requires a multi-layered approach. By implementing robust security measures, platforms can build trust with users and ensure the responsible use of this sensitive information for scientific progress and personalized medicine.
- mRNA-based therapeutics companies identify targets, design therapies, understand disease mechanisms, personalize treatments, and optimize delivery systems, ultimately leading to the creation of more effective and innovative treatments for a wide range of diseases. They invest heavily in researching and developing mRNA therapies. Theft of trade secrets related to target identification, mRNA design, or delivery systems could give competitors an unfair advantage. Robust cybersecurity measures and employee training on data security are crucial.

## TrueNil key features
TrueNil is a multi-tenant SaaS application hosted in AWS built to detect sensitive data stored in S3 buckets and DynamoDB:
- User registration
- User authentication using Google SSO
- Agent health check
- Truenil discovers and detects sensitive data like genomic data, PII data, PCI data, and certain types of PHI data
- TrueNil allows access to executive risk dashboard using Google’s Single Sign On (SSO)
- TrueNil detects human and non-human access to the sensitive data
- TrueNil detects the encryption at rest status of the sensitive data
- If AWS CloudTrail is enabled, then TrueNil tracks user’s actions performed on sensitive data
- Granular role-based access control to ensure that only authorized users can access data
    - Superadmin
    - Researcher
    - Operator

## Intended Audience
- Anyone who would like to discover and protect genomic data
- IT, developers, security engineers working with applications and systems processing genomic data
- Data privacy officers or chief security officers who would like to see one-stop view of genomic data and their security posture

## TrueNil High-Level Architecture
### Component Description
- Web Backend: Backend application to store metadata, user management, and information related to access control and encryption. It connects with other common elements such as dartstores, cache, notification, etc.
- Web Frontend: Control plane for Admin users containing user enrollment, organizational onboarding. Application plane for other users to see data security posture.
- Agent backend: It processes information received by Agents and sends it to the web backend.
- Agent: TN agent scans data stored in S3 and DynamoDB to detect sensitive and non-sensitive information and provide one top view of security status. Audit log of every action made by the agent, including communication with the backend.

## Setup
### Agent Installation Steps
1. Spin up a Linux EC2 instance in the California region.
2. Select Ubuntu as the operating system.
3. Create an RSA PEM key.
4. Change the permission of the .pem key using `chmod`.
5. Go to the folder where the .pem file is located.
6. SSH into the EC2 instance using the command `sudo ssh -i truenil_prism4.pem ubuntu@3.101.42.114`.
7. Update the system using `sudo apt update`.
8. Generate a GitHub token.
9. Create a virtual environment using `sudo apt install virtualenv` and `virtualenv --python=python3 your_env_name`.
10. Change the permission of the environment using `sudo chmod -R a+rwx truenil_agent`.
11. Install Git using `sudo apt install git`.
12. Clone the agent repository using `git clone https://github.com/TrueNil-Prism/agent.git`.
13. Enter your GitHub username or email and access token generated using the steps above.
14. Pull the agent branch from Git in a virtual environment dev branch.
15. Change the agent folder permission using `sudo chmod -R a+rwx agent`.
16. Activate the Python environment using `source truenil_agent/bin/activate`.
17. Install the requirements.txt file using `pip install -r requirement.txt`.
18. Install Supervisor using `sudo apt install supervisor` outside the virtual environment.
19. Restart Supervisor using `sudo systemctl start supervisor`.
20. Check the status of Supervisor using `sudo systemctl status supervisor` (Supervisor is a process handler for our script).
21. Configure the credentials.json file to specify the data source for the agent.
22. Go to the `/etc/supervisor/conf.d` directory.
23. Create a conf file using `sudo touch healthstatus.conf`.
24. Add the following content to the conf file:
```yaml
[program:agent_health_check]
command=/home/admin/truenil-dev/bin/python /home/admin/agent/healthCheck.py
directory=/home/admin/agent
autostart=true
autorestart=true
Create a conf file with command sudo touch datacheck.conf
[program:agent_data_check]
command=/home/admin/truenil-dev/bin/python /home/admin/agent/data_check.py
directory=/home/admin/agent
autostart=true
autorestart=true
```
25. Here replace truenil-dev with your enviorment name (truenil_agent)
Go to agent directory credentials.json file and modify it by adding 
```json
{
    "aws_access_key_id": "AKIAWGGT3XXXXXXXXXXXXX",
    "aws_secret_access_key": "zOzDS8QNBWdieqZWGMXXXXXXXXXXXXXXXXX",
    "bucket_name": "trulnil-agent",
    "organization_id": "2",
    "name": "Truenil",
    "register_url": "https://dev-agent.truenil.io/v1/register_agent/",
    "token": "82ugJxJQxFQo0WgHqvEWnmOiJDcXXXXXXXXXXXXXXXX",
    "metric_url": "https://dev-agent.truenil.io/v1/metrics/",
    "file_url": "https://dev-agent.truenil.io/v1/file/",
    "user_permission_url": "https://dev-agent.truenil.io/v1/user_file_permissions/",
    "dynamodb_table_name": "truenil_prism_mvp"
}
```


26. Here replace 2 with your organization id and truenil with your agent name

Following information we need to connect with AWS 
```
AWS_access_key_id: 
Aws_secret_access_key:
Bucket_name: 
dynamodb_table_name:
```
Rest everything is same
Check with kartik@truenil.io on how to get access to tokens 

Restart supervisor with “sudo systemctl restart supervisor”
Congratulations!! You have successfully setup the supervisor

> :bulb: **Tip:** Useful Links: http://supervisord.org/
To run agent from the docker as part of the local dev env setup
1. Checkout agent source code from gitHub
      git clone -b dev git@github.com:TrueNil-Prism/agent.git
2. cd in to agent folder
3. Build a docker image
  docker build -t supervisor .
4. Run the container
  ```
  docker run -dp 9001:9001 --name supervisor supervisor
```
5. Now you can go to http://localhost:9001 in your browser and log in using the data from the supervisord.conf file
Adding a customer organization set up instructions 
```
Insert a row into core.organization table located at Postgress DB
INSERT INTO core.organization(
	created_at, updated_at, created_by, updated_by, name, website, details)
	VALUES (now(), now(), 'SYSTEM', 'SYSTEM', 'BatchX', 'www.batchx.org', 'details');
For user provisioning: Insert a row into core.users table
INSERT INTO core.users(
	 created_at, updated_at, created_by, updated_by, organization_id, user_first_name, user_last_name, email, password, access_token, refresh_token, organization_name, 
	    role, otp, mfa, email_valid, mfa_type, otp_expiry, mfa_secret, mfa_uri, mfa_verified)
	VALUES (now(), now(), 'SYSTEM', 'SYSTEM', 
			2, -- organization_id
			'fname', 'lname', 'email', 'f925916e2754e5e03f75dd58a5733251', 
			'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6Im1hdGhhbisXXXXXXXXXXXXXLCJvcmdhbml6YXRpb24iOiJmbGlwa29pbnMiLCJleHAiOjE2OTYwODEzNDN9.u_r6BJPTGQS6gPEifMhOss4_AJVW8_Ch5-8pFDhFUR4',
			null, -- refresh token
			'BatchX', 
			'researcher', 
			'', 
			true, true, 'email', 
			now() + interval '2 months', 
			null, null, true, 
			false);
```
Insert into core.organization_users associating the users to the organization.

## AWS Backend Setup Instructions

[Link to backend repository](https://github.com/TrueNil-Prism/web-backend/blob/main/README.md)

Steps to start the server:

1. SSH into the server:
    ```bash
    ssh -i ~/Downloads/dev-truenil-keypair.pem admin@10.0.150.153
    ```

2. Create a virtual environment:
    ```bash
    virtualenv --python=python3 truenil-dev
    ```

3. Activate the virtual environment:
    ```bash
    source truenil-dev/bin/activate
    ```

4. Change to the backend directory:
    ```bash
    cd /home/admin/web-backend
    ```

5. Install the required packages:
    ```bash
    pip install fastapi
    pip install uvicorn
    pip install python-dotenv
    pip install peewee
    pip install requests
    ```

6. Start the server:
    ```bash
    nohup python3 main.py &
    ```
## Agent Backend Installation
[Link to Repository](https://github.com/TrueNil-Prism/agent-backend/tree/main#readme)

### Steps to Start the Server
1. SSH into the server:
    ```bash
    ssh -i ~/Downloads/dev-truenil-keypair.pem admin@10.0.150.153
    ```

2. Change directory to `agent-backend`:
    ```bash
    cd /home/admin/agent-backend
    ```

3. Create a virtual environment:
    ```bash
    virtualenv --python=python3 venv
    ```

4. Activate the virtual environment:
    ```bash
    source ./venv/bin/activate
    ```

5. Install the required packages:
    ```bash
    pip install uvicorn
    pip install fastapi
    pip install peewee
    pip install python-dotenv
    pip install --upgrade psycopg2-binary
    ```

6. Change directory to `src`:
    ```bash
    cd src
    ```

7. Start the server:
    ```bash
    nohup uvicorn truenil.api.main:app --host 0.0.0.0 --port 9000 --reload &
    ```

### Set up required for Front-end
[Link to Front-end Setup](https://dev-app.truenil.io/)

## Frontend application deployment

**Prerequisite for frontend application:**

- Install Node.js version 18.13.0. Use the following command in a Linux EC2 instance to install Node.js:

    ```shell
    sudo apt install nodejs
    ```

- Install PM2 globally (version 5.3.0):

    ```shell
    sudo npm install pm2 -g
    ```

- Install Git (version 2.39.2):

    ```shell
    sudo apt install git-all
    ```

**Clone application into the required EC2 instance:**

1. Navigate inside the `web-frontend` folder and run `npm install`.
2. Once the package installation is complete, run `npm run build`.
3. Once the build is complete, run the following one-time command to start the application using PM2:

     ```shell
     pm2 start npm --name "web-frontend" -- start
     ```

     Note: Once it is started, please use the ID mentioned in the below screen to restart the application like this -> `pm2 restart 0`.

**Useful commands:**

- Start command: `pm2 start 0`
- Stop command: `pm2 stop 0`
- List all applications running in PM2: `pm2 list`

**Troubleshooting:**

If you encounter any issues, please contact tru@truenil.io.

> **Warning:**
> This tool is created purely for learning and educational purposes. The author and development team will not be responsible for any harmful actions.

**Acknowledgments:**

It takes a village to build an innovative tool from scratch, and besides the development team, many friends have contributed to this open-source project.

For more information, refer to the [official PM2 documentation](https://pm2.io/).
